# Калькулятор Weakest Precondition

## О проекте

WPF приложение для автоматического расчета наименьших предусловий на основе логики Хоара.
Проект демонстрирует применение формальных методов верификации программ через вычисление weakest precondition для различных программных конструкций.

**Основная цель**: Реализация системы вычисления weakest precondition для операторов присваивания, условных операторов и последовательностей операторов с визуализацией процесса расчета.

## Архитектура проекта

- src/
  - WPCalculator/
    - Models/
      - Expression.cs
      - Statement.cs
      - ProgramParser.cs
      - CalculationStep.cs
    - ViewModels/
      - WPCalculatorViewModel.cs
    - Views/
- tests/
  - ExpressionTests.cs
  - IntegrationTests.cs
  - ProgramParserTests.cs
  - StatementTest.cs
- docs/
  - Отчёт.docx

## Функциональность

### Реализованные операции

**Вычисление WP для присваивания**
- Правило: wp(x := E, R) = R[E/x]
- Автоматическая замена переменных
- Проверки определенности

**Вычисление WP для условных операторов**  
- Правило: wp(if B then S1 else S2, R) = (B ∧ wp(S1, R)) ∨ (¬B ∧ wp(S2, R))
- Рекурсивный расчет для обеих веток
- Корректное отрицание условий

**Вычисление WP для последовательностей**
- Правило: wp(S1; S2, R) = wp(S1, wp(S2, R))
- Обработка с конца последовательности
- Пошаговая трассировка

### Визуальные возможности

- Пошаговый просчет - детальная трассировка процесса расчета WP
- Человекочитаемое представление - автоматический перевод математических выражений на русский язык
- Триады Хоара - формирование триад в формате {Pre} программа {Post}
- Готовые примеры - набор пресетов для быстрого тестирования

## Технологии

- NET 8 - целевая платформа
- WPF - пользовательский интерфейс  
- MVVM - архитектурный паттерн
- INotifyPropertyChanged - механизм уведомлений об изменениях
- Регулярные выражения - парсинг и преобразование выражений

## Принципы Weakest Precondition

### Правила вычисления

**Присваивание**
wp(x := E, R) = R[E/x]

**Условный оператор**
wp(if B then S1 else S2, R) = (B ∧ wp(S1, R)) ∨ (¬B ∧ wp(S2, R))

**Последовательность**
wp(S1; S2, R) = wp(S1, wp(S2, R))

### Примеры расчетов

**Пример 1: Простое присваивание**
Программа: x := 10  
Постусловие: x > 5  
WP: 10 > 5

**Пример 2: Условный оператор**
Программа: if (x > 0) y := 10 else y := 0  
Постусловие: y >= 0  
WP: (x > 0 ∧ 10 >= 0) ∨ (!(x > 0) ∧ 0 >= 0)

## Запуск проекта

### Предварительные требования

- NET 8 SDK или выше
- Visual Studio 2022 или VS Code с C# расширениями

### Инструкция по запуску

1. Клонирование репозитория
```bash
git clone <repository-url>
cd WPCalculator
```

2. Восстановление зависимостей
```bash
dotnet restore
```

3. Сборка проекта
```bash
dotnet build
```

4. Запуск приложения
```bash
dotnet run --project WPCalculator csproj
```

**Альтернативный запуск через Visual Studio**
- Откройте WPCalculator.sln
- Установите WPF проект как стартовый
- Нажмите F5 для запуска

**Использование приложения**
Расчет Weakest Precondition
1. Ввод программы - введите код программы в текстовое поле
2. Задание постусловия - укажите условие, которое должно выполняться после программы
3. Запуск расчета - нажмите кнопку "Calculate WP" для начала вычислений
4. Анализ результатов - изучите пошаговый расчет и итоговое предусловие

**Работа с пресетами**
1. Выберите готовый пример из выпадающего списка
2. Программа и постусловие заполнятся автоматически
3. Используйте для быстрого тестирования функциональности
**Просмотр триад Хоара**
- После расчета WP нажмите "Show Hoare Triple"
- Изучите сформированную триаду: {Precondition} программа {Postcondition}

**Тестирование функциональности**

**Штатные сценарии**

1. Присваивания
- Простые переменные: x := 5
- Арифметические выражения: y := x + 1
- Множественные присваивания

2. Условные операторы
- Простые условия: if (x > 0)
- Сложные логические выражения
- Вложенные условия

3. Последовательности операторов
- Линейные последовательности
- Комбинации присваиваний и условий

**Граничные случаи**
- Корректная обработка скобок в выражениях
- Учет приоритета операторов в логических выражениях
- Проверки определенности для математических операций

**Структура данных**

**Класс Expression**
Базовый класс для представления математических и логических выражений

```csharp
public abstract class Expression
{
    public abstract Expression Substitute(string variable, string expression)
    public abstract string ToHumanReadable()
    public virtual List<string> GetDefinitenessConditions()
}
```

**Класс Statement**
Базовый класс для представления программных операторов

```csharp
public abstract class Statement
{
    public abstract (Expression wp, List<string> steps) CalculateWP(
        Expression postCondition, string stepPrefix = "")
}
```

**Особенности реализации**

**Надежность вычислений**
- Многоуровневая валидация входных данных
- Обработка исключений на всех этапах расчета
- Проверки определенности для предотвращения ошибок выполнения

**Пользовательский интерфейс**
- Реактивный дизайн - мгновенное обновление при изменении данных
- Подробная трассировка - пошаговое отображение процесса расчета
- Интуитивное управление - понятные элементы управления и сообщения

**Расширяемость**
- Модульная архитектура - легкость добавления новых типов выражений и операторов
- Чистое разделение ответственности - отделение логики от представления
- Гибкая система парсинга - поддержка различных форматов входных данных

**Дальнейшее развитие**

Возможные направления для улучшения проекта

1. Поддержка циклов - реализация расчета WP для циклов с инвариантами
2. Расширенный синтаксис - поддержка большего количества языковых конструкций
3. Визуализация AST - графическое представление абстрактного синтаксического дерева
4. Интеграция с языками программирования - поддержка реальных языков программирования
5. Оптимизация выражений - автоматическое упрощение логических выражений

**Разработчики:**
Полосков А.Д. Дубков С.В. Иванов М.А. Ткаченко А.А.
Проект разработан в учебных целях для демонстрации принципов верификации программ на основе логики Хоара и вычисления weakest precondition

**Лицензия**
Проект создан для образовательных целей Свободное использование и модификация разрешены
